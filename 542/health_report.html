<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>芯片数据实时接收系统 - 健康评估报告</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f4c81',
                        secondary: '#3a7ca5',
                        accent: '#d9dcd6',
                        warning: '#e74c3c',
                        success: '#2ecc71',
                        dark: '#1a365d',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .text-shadow {
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-900">
    <div class="min-h-screen-screen flex flex-col">
        <!-- 顶部导航栏 -->
        <header class="bg-primary text-white shadow-md">
            <div class="container mx-auto px-4 py-3 flex items-center-center justify-between">
                <div class="flex items-center-center space-x-4">
                    <i class="fa fa-microchip text-2xl"></i>
                    <h1 class="text-xl font-bold">芯片数据实时接收系统</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-white hover:text-blue-200 flex items-center">
                        <i class="fa fa-arrow-left mr-1"></i> 返回主页
                    </a>
                    <button id="print-report" class="bg-secondary hover:bg-blue-600 text-white px-3 py-1 rounded-md text-sm flex items-center">
                        <i class="fa fa-print mr-1"></i> 打印报告
                    </button>
                    <button id="export-pdf" class="bg-secondary hover:bg-blue-600 text-white px-3 py-1 rounded-md text-sm flex items-center">
                        <i class="fa fa-download mr-1"></i> 导出PDF
                    </button>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="flex-grow p-4 md:p-6 overflow-auto">
            <!-- 报告标题 -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex flex-col md:flex-row-row justify-between items-center-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">建筑健康评估报告</h2>
                        <p class="text-gray-600">生成时间: <span id="report-time">2025-07-22 15:30:45</span></p>
                    </div>
                    <div class="mt-4 md:mt-0">
                        <span id="report-status" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-500 text-white">
                            <span class="inline-block w-3 h-3 rounded-full bg-white mr-2"></span>
                            正常
                        </span>
                    </div>
                </div>
            </div>

            <!-- 报告摘要 -->
            <div class="bg-white rounded rounded-lg-md p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">报告摘要</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- 健康评分 -->
                    <div class="bg-gray-50 p-4 rounded-md">
                        <h4 class="font-medium text-gray-700 mb-2 text-center">健康评分</h4>
                        <div class="flex items-center justify-center">
                            <div class="relative w-32 h-32">
                                <canvas id="health-score-gauge"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="health-score-value" class="text-4xl font-bold">95</span>
                                    <span class="text-sm text-gray-500">/100</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 text-center">
                            <span id="health-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1"></span>
                                优秀
                            </span>
                        </div>
                    </div>
                    
                    <!-- 异常统计 -->
                    <div class="bg-gray-50 p-4 rounded-md">
                        <h4 class="font-medium text-gray-700 mb-2 text-center">异常统计</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">检测到的异常</span>
                                <span id="anomaly-count" class="text-sm font-medium">0 个</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">异常率</span>
                                <span id="anomaly-rate" class="text-sm font-medium">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">最近异常</span>
                                <span id="last-anomaly" class="text-sm font-medium">无</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据质量 -->
                    <div class="bg-gray-50 p-4 rounded-md">
                        <h4 class="font-medium text-gray-700 mb-2 text-center">数据质量</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">数据完整性</span>
                                <span id="data-completeness" class="text-sm font-medium">100%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">数据准确性</span>
                                <span id="data-accuracy" class="text-sm font-medium">98.5%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">数据稳定性</span>
                                <span id="data-stability" class="text-sm font-medium">96.2%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 健康趋势 -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">健康趋势</h3>
                <div class="h-80 bg-gray-50 p-4 rounded-md">
                    <canvas id="health-trend-chart"></canvas>
                </div>
                <div class="mt-4">
                    <p id="trend-analysis" class="text-sm text-gray-600">
                        健康评分保持稳定，无明显下降趋势。过去30分钟内，健康评分平均为95分，波动范围在93-97分之间，表明建筑结构处于良好状态。
                    </p>
                </div>
            </div>

            <!-- 关键指标分析 -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">关键指标分析</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">指标</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">平均值</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">标准差</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最小值</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最大值</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">正常范围</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                            </tr>
                        </thead>
                        <tbody id="metrics-table" class="bg-white divide-y divide-gray-200">
                            <!-- 指标数据将通过JavaScript动态添加 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 异常日志 -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-700">异常日志</h3>
                    <span id="anomaly-log-count" class="text-sm text-gray-600">显示最近 10 条记录</span>
                </div>
                <div class="overflow-x-auto">
                    <div class="max-h-60 overflow-y-auto scrollbar-hide">
                        <table id="anomaly-log-table" class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0 z-10">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">异常原因</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">温度 (°C)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">压力值 (G)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">震动程度 (Z)</th>
                                </tr>
                            </thead>
                            <tbody id="anomaly-log-body" class="bg-white divide-y divide-gray-200">
                                <!-- 异常日志将通过JavaScript动态添加 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="no-anomaly-message" class="text-center py-4 text-gray-500">
                    未检测到任何异常
                </div>
            </div>

            <!-- 问题与建议 -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">问题与建议</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 检测到的问题 -->
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fa fa-exclamation-circle text-warning mr-2"></i>检测到的问题
                        </h4>
                        <ul id="issues-list" class="list-disc pl-5 space-y-1 text-sm text-gray-600">
                            <!-- 问题将通过JavaScript动态添加 -->
                        </ul>
                    </div>
                    
                    <!-- 建议措施 -->
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2 flex items-center">
                            <i class="fa fa-lightbulb-o text-yellow-500 mr-2"></i>建议措施
                        </h4>
                        <ul id="recommendations-list" class="list-disc pl-5 space-y-1 text-sm text-gray-600">
                            <!-- 建议将通过JavaScript动态添加 -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 报告结论 -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">报告结论</h3>
                <div id="report-conclusion" class="bg-gray-50 p-4 rounded-md text-gray-700">
                    <!-- 报告结论将通过JavaScript动态添加 -->
                </div>
            </div>
        </main>

        <!-- 底部状态栏 -->
        <footer class="bg-dark text-white py-2 px-4">
            <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
                <div class="text-sm mb-2 md:mb-0">
                    芯片数据实时接收系统 v1.0 - 健康评估报告
                </div>
                <div class="text-sm">
                    报告生成时间: <span id="footer-report-time">2025-07-22 15:30:45</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- 平台层脚本 -->
    <script src="platform_layer.js"></script>

    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化图表
            initializeCharts();
            
            // 加载健康评估报告
            loadHealthReport();
            
            // 设置事件监听器
            setupEventListeners();
        });
        
        // 初始化图表
        function initializeCharts() {
            // 健康评分仪表盘
            const healthScoreCtx = document.getElementById('health-score-gauge').getContext('2d');
            window.healthScoreGauge = new Chart(healthScoreCtx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [95, 5],
                        backgroundColor: [
                            '#2ecc71',
                            '#e9ecef'
                        ],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    }
                }
            });
            
            // 健康趋势图表
            const healthTrendCtx = document.getElementById('health-trend-chart').getContext('2d');
            window.healthTrendChart = new Chart(healthTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '健康评分',
                        data: [],
                        borderColor: '#0f4c81',
                        backgroundColor: 'rgba(15, 76, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '时间'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '健康评分'
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
        
        // 加载健康评估报告
        function loadHealthReport() {
            // 生成健康评估报告
            const healthReport = platformLayer.generateHealthReport();
            
            // 生成数据质量报告
            const dataQualityReport = platformLayer.generateDataQualityReport();
            
            // 获取异常日志
            const anomalyLog = platformLayer.getAnomalyLog(10);
            
            // 获取健康历史
            const healthHistory = platformLayer.getHealthHistory(30);
            
            // 更新报告时间
            const now = new Date();
            const timeString = now.toLocaleString();
            document.getElementById('report-time').textContent = timeString;
            document.getElementById('footer-report-time').textContent = timeString;
            
            // 更新健康评分
            document.getElementById('health-score-value').textContent = healthReport.healthScore.current;
            updateGauge(window.healthScoreGauge, healthReport.healthScore.current, 0, 100, getHealthScoreColor(healthReport.healthScore.current));
            
            // 更新健康状态
            document.getElementById('health-status').innerHTML = `
                <span class="inline-block w-2 h-2 rounded-full ${getHealthStatusColor(healthReport.healthScore.status.text)} mr-1"></span>
                ${healthReport.healthScore.status.text}
            `;
            
            // 更新报告状态
            document.getElementById('report-status').innerHTML = `
                <span class="inline-block w-3 h-3 rounded-full bg-white mr-2"></span>
                ${healthReport.healthScore.status.text}
            `;
            document.getElementById('report-status').className = `inline-flex items-center px-4 py-2 rounded-full text-sm font-medium ${getHealthStatusBgColor(healthReport.healthScore.status.text)} text-white`;
            
            // 更新异常统计
            document.getElementById('anomaly-count').textContent = `${healthReport.anomalyStats.count} 个`;
            document.getElementById('anomaly-rate').textContent = `${healthReport.anomalyStats.rate}%`;
            
            // 更新最近异常
            if (anomalyLog.length > 0) {
                document.getElementById('last-anomaly').textContent = anomalyLog[0].timeString;
            } else {
                document.getElementById('last-anomaly').textContent = '无';
            }
            
            // 更新数据质量
            document.getElementById('data-completeness').textContent = dataQualityReport.metrics.completeness.value;
            document.getElementById('data-accuracy').textContent = dataQualityReport.metrics.accuracy.value;
            document.getElementById('data-stability').textContent = dataQualityReport.metrics.stability.value;
            
            // 更新健康趋势图表
            updateHealthTrendChart(healthHistory);
            
            // 更新趋势分析
            updateTrendAnalysis(healthReport.healthScore.trend);
            
            // 更新关键指标表格
            updateMetricsTable(healthReport.keyMetrics);
            
            // 更新异常日志
            updateAnomalyLog(anomalyLog);
            
            // 更新问题与建议
            updateIssuesAndRecommendations(healthReport.issues, healthReport.recommendations);
            
            // 更新报告结论
            updateReportConclusion(healthReport, dataQualityReport, anomalyLog);
        }
        
        // 更新仪表盘
        function updateGauge(gauge, value, min, max, color) {
            const percentage = ((value - min) / (max - min)) * 100;
            const remaining = 100 - percentage;
            
            gauge.data.datasets[0].data = [percentage, remaining];
            gauge.data.datasets[0].backgroundColor[0] = color;
            gauge.update();
        }
        
        // 获取健康评分颜色
        function getHealthScoreColor(score) {
            if (score >= 90) {
                return '#2ecc71'; // 优秀 - 绿色
            } else if (score >= 80) {
                return '#3498db'; // 良好 - 蓝色
            } else if (score >= 70) {
                return '#3498db'; // 正常 - 蓝色
            } else if (score >= 60) {
                return '#f39c12'; // 警告 - 黄色
            } else {
                return '#e74c3c'; // 危险 - 红色
            }
        }
        
        // 获取健康状态颜色
        function getHealthStatusColor(status) {
            switch (status) {
                case '优秀':
                    return 'bg-green-500';
                case '良好':
                    return 'bg-green-400';
                case '正常':
                    return 'bg-blue-400';
                case '警告':
                    return 'bg-yellow-500';
                case '危险':
                    return 'bg-red-500';
                default:
                    return 'bg-gray-500';
            }
        }
        
        // 获取健康状态背景颜色
        function getHealthStatusBgColor(status) {
            switch (status) {
                case '优秀':
                    return 'bg-green-500';
                case '良好':
                    return 'bg-green-400';
                case '正常':
                    return 'bg-blue-400';
                case '警告':
                    return 'bg-yellow-500';
                case '危险':
                    return 'bg-red-500';
                default:
                    return 'bg-gray-500';
            }
        }
        
        // 更新健康趋势图表
        function updateHealthTrendChart(healthHistory) {
            // 准备图表数据
            const labels = healthHistory.map(h => new Date(h.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
            const scores = healthHistory.map(h => h.score);
            
            // 更新图表
            window.healthTrendChart.data.labels = labels;
            window.healthTrendChart.data.datasets[0].data = scores;
            window.healthTrendChart.update();
        }
        
        // 更新趋势分析
        function updateTrendAnalysis(trend) {
            const trendElement = document.getElementById('trend-analysis');
            
            if (trend > 0.1) {
                trendElement.textContent = `健康评分呈上升趋势，变化率为 ${trend}/分钟。过去30分钟内，健康评分平均为 ${Math.round((95 + trend * 30) / 2)} 分，表明建筑结构状态正在改善。`;
            } else if (trend < -0.1) {
                trendElement.textContent = `健康评分呈下降趋势，变化率为 ${Math.abs(trend)}/分钟。过去30分钟内，健康评分平均为 ${Math.round((95 + trend * 30) / 2)} 分，表明建筑结构状态正在恶化，建议密切关注。`;
            } else {
                trendElement.textContent = `健康评分保持稳定，无明显下降趋势。过去30分钟内，健康评分平均为 95 分，波动范围在 ${Math.round(95 - Math.abs(trend) * 30)} - ${Math.round(95 + Math.abs(trend) * 30)} 分之间，表明建筑结构处于良好状态。`;
            }
        }
        
        // 更新关键指标表格
        function updateMetricsTable(metrics) {
            const tableBody = document.getElementById('metrics-table');
            tableBody.innerHTML = '';
            
            // 温度
            addMetricRow(tableBody, '温度', metrics.temperature, platformLayer.config.normalRanges.temperature.min, platformLayer.config.normalRanges.temperature.max);
            
            // 电压
            addMetricRow(tableBody, '压力值', metrics.voltage, platformLayer.config.normalRanges.voltage.min, platformLayer.config.normalRanges.voltage.max);
            
            // 电流
            addMetricRow(tableBody, '震动程度', metrics.current, platformLayer.config.normalRanges.current.min, platformLayer.config.normalRanges.current.max);
            
            // 振动强度
            addMetricRow(tableBody, '振动强度', metrics.vibration, 0, platformLayer.config.normalRanges.vibration.max, true);
            
            // 位移
            addMetricRow(tableBody, '位移', metrics.displacement, 0, platformLayer.config.normalRanges.displacement.max, true);
            
            // 倾斜角度
            addMetricRow(tableBody, '倾斜角度', metrics.tilt, 0, platformLayer.config.normalRanges.tilt.max, true);
        }
        
        // 添加指标行
        function addMetricRow(tableBody, name, metric, min, max, isUpperBoundOnly = false) {
            const row = document.createElement('tr');
            
            // 计算平均值是否在正常范围内
            const mean = parseFloat(metric.mean);
            let status, statusClass;
            
            if (isUpperBoundOnly) {
                if (mean <= max * 0.8) {
                    status = '正常';
                    statusClass = 'bg-green-100 text-green-800';
                } else if (mean <= max * 0.9) {
                    status = '注意';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                } else if (mean <= max) {
                    status = '警告';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                } else {
                    status = '异常';
                    statusClass = 'bg-red-100 text-red-800';
                }
            } else {
                const range = max - min;
                const lowerWarning = min + range * 0.1;
                const upperWarning = max - range * 0.1;
                
                if (mean >= lowerWarning && mean <= upperWarning) {
                    status = '正常';
                    statusClass = 'bg-green-100 text-green-800';
                } else if (mean >= min && mean <= max) {
                    status = '注意';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                } else {
                    status = '异常';
                    statusClass = 'bg-red-100 text-red-800';
                }
            }
            
            // 正常范围显示
            const normalRange = isUpperBoundOnly ? 
                `≤ ${max}${metric.unit}` : 
                `${min}-${max}${metric.unit}`;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${metric.mean} ${metric.unit}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${metric.stdDev} ${metric.unit}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${metric.min} ${metric.unit}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${metric.max} ${metric.unit}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${normalRange}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
                        ${status}
                    </span>
                </td>
            `;
            
            tableBody.appendChild(row);
        }
        
        // 更新异常日志
        function updateAnomalyLog(anomalyLog) {
            const tableBody = document.getElementById('anomaly-log-body');
            tableBody.innerHTML = '';
            
            // 显示/隐藏无异常消息
            if (anomalyLog.length === 0) {
                document.getElementById('no-anomaly-message').classList.remove('hidden');
                document.getElementById('anomaly-log-table').classList.add('hidden');
                document.getElementById('anomaly-log-count').classList.add('hidden');
                return;
            } else {
                document.getElementById('no-anomaly-message').classList.add('hidden');
                document.getElementById('anomaly-log-table').classList.remove('hidden');
                document.getElementById('anomaly-log-count').classList.remove('hidden');
            }
            
            // 更新异常日志计数
            document.getElementById('anomaly-log-count').textContent = `显示最近 ${anomalyLog.length} 条记录`;
            
            // 添加异常日志行
            anomalyLog.forEach(anomaly => {
                const row = document.createElement('tr');
                row.className = 'bg-red-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${anomaly.timeString}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${anomaly.reason}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${anomaly.data.temperature ? anomaly.data.temperature.toFixed(1) : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${anomaly.data.voltage ? anomaly.data.voltage.toFixed(2) : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${anomaly.data.current ? anomaly.data.current.toFixed(1) : '-'}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // 更新问题与建议
        function updateIssuesAndRecommendations(issues, recommendations) {
            const issuesList = document.getElementById('issues-list');
            const recommendationsList = document.getElementById('recommendations-list');
            
            // 清空列表
            issuesList.innerHTML = '';
            recommendationsList.innerHTML = '';
            
            // 添加问题
            if (issues.length === 0) {
                issuesList.innerHTML = '<li class="text-gray-500 italic">未检测到任何问题</li>';
            } else {
                issues.forEach(issue => {
                    const li = document.createElement('li');
                    li.textContent = issue;
                    issuesList.appendChild(li);
                });
            }
            
            // 添加建议
            if (recommendations.length === 0) {
                recommendationsList.innerHTML = '<li class="text-gray-500 italic">暂无建议</li>';
            } else {
                recommendations.forEach(recommendation => {
                    const li = document.createElement('li');
                    li.textContent = recommendation;
                    recommendationsList.appendChild(li);
                });
            }
        }
        
        // 更新报告结论
        function updateReportConclusion(healthReport, dataQualityReport, anomalyLog) {
            const conclusionElement = document.getElementById('report-conclusion');
            
            // 分析测试结果
            let conclusion = '<p class="mb-2">';
            
            // 健康评分结论
            conclusion += `<strong>健康状态：</strong>当前健康评分为 ${healthReport.healthScore.current}/100，${healthReport.healthScore.status.text}状态。`;
            
            if (healthReport.healthScore.current >= 90) {
                conclusion += ' 建筑结构状态优秀，各项指标均在正常范围内。</p>';
            } else if (healthReport.healthScore.current >= 80) {
                conclusion += ' 建筑结构状态良好，各项指标基本正常。</p>';
            } else if (healthReport.healthScore.current >= 70) {
                conclusion += ' 建筑结构状态一般，部分指标接近警告阈值。</p>';
            } else if (healthReport.healthScore.current >= 60) {
                conclusion += ' 建筑结构状态警告，多项指标超出正常范围，建议检查。</p>';
            } else {
                conclusion += ' 建筑结构状态危险，多项指标严重超出正常范围，需要立即处理。</p>';
            }
            
            // 健康趋势结论
            const trend = parseFloat(healthReport.healthScore.trend);
            conclusion += `<p class="mb-2"><strong>健康趋势：</strong>健康评分${trend > 0 ? '呈上升' : trend < 0 ? '呈下降' : '保持稳定'}趋势，变化率为 ${Math.abs(trend)}/分钟。`;
            
            if (trend > 0.1) {
                conclusion += ' 建筑结构状态正在改善。</p>';
            } else if (trend < -0.1) {
                conclusion += ' 建筑结构状态正在恶化，建议密切关注。</p>';
            } else {
                conclusion += ' 建筑结构状态保持稳定。</p>';
            }
            
            // 异常检测结论
            conclusion += `<p class="mb-2"><strong>异常情况：</strong>共检测到 ${anomalyLog.length} 个异常，异常率为 ${healthReport.anomalyStats.rate}%。`;
            
            if (anomalyLog.length === 0) {
                conclusion += ' 未检测到任何异常，建筑结构运行稳定。</p>';
            } else if (anomalyLog.length < 5) {
                conclusion += ' 检测到少量异常，可能是临时性干扰引起的。</p>';
            } else if (anomalyLog.length < 10) {
                conclusion += ' 检测到一定数量的异常，需要关注建筑结构稳定性。</p>';
            } else {
                conclusion += ' 检测到大量异常，建筑结构存在严重问题，需要立即处理。</p>';
            }
            
            // 数据质量结论
            conclusion += `<p class="mb-2"><strong>数据质量：</strong>数据质量评分为 ${dataQualityReport.dataQualityScore}/100，${dataQualityReport.qualityLevel.name}等级。`;
            
            if (dataQualityReport.dataQualityScore >= 90) {
                conclusion += ' 数据质量优秀，评估结果可靠。</p>';
            } else if (dataQualityReport.dataQualityScore >= 80) {
                conclusion += ' 数据质量良好，评估结果基本可靠。</p>';
            } else if (dataQualityReport.dataQualityScore >= 70) {
                conclusion += ' 数据质量一般，评估结果仅供参考。</p>';
            } else {
                conclusion += ' 数据质量较差，评估结果可能存在偏差。</p>';
            }
            
            // 总体结论
            conclusion += '<p><strong>总体结论：</strong>';
            
            if (healthReport.healthScore.current >= 80 && anomalyLog.length < 5 && dataQualityReport.dataQualityScore >= 80) {
                conclusion += '建筑结构整体健康状况良好，各项指标均在正常范围内，无明显异常。建议保持当前的监控频率，定期生成健康评估报告以跟踪建筑结构状态变化。</p>';
            } else if (healthReport.healthScore.current >= 70 && anomalyLog.length < 10 && dataQualityReport.dataQualityScore >= 70) {
                conclusion += '建筑结构整体健康状况一般，存在一些需要关注的问题。建议增加监控频率，密切关注建筑结构状态变化，及时采取措施防止问题恶化。</p>';
            } else {
                conclusion += '建筑结构整体健康状况较差，存在较多问题和异常。建议立即进行详细检查和评估，采取必要的维修和加固措施，确保建筑结构安全。</p>';
            }
            
            // 更新结论
            conclusionElement.innerHTML = conclusion;
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 打印报告按钮
            document.getElementById('print-report').addEventListener('click', function() {
                window.print();
            });
            
            // 导出PDF按钮
            document.getElementById('export-pdf').addEventListener('click', function() {
                alert('PDF导出功能正在开发中，敬请期待！');
            });
        }
    </script>
</body>
</html>
